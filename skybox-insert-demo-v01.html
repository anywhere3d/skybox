<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta name="description" contents="Dress Outfit Insert Form from aw3d-v1.0 boilerplate.">
    <link rel="manifest" href="/manifest.json">
    <title>Skybox insert form (v0.1)</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootbox-dialoges.css">
    <link rel="stylesheet" href="/css/side-panels.css">
    <link rel="stylesheet" href="/css/messg.css" >
    <link rel="stylesheet" href="/css/spectrum.css">
    <link rel="stylesheet" href="/css/colorpicker.css">
    <link rel="stylesheet" href="/css/spinner.css">
    <link rel="stylesheet" href="/css/jquery-ui.css">
    <link rel="stylesheet" href="/css/alerts.css">
    <link rel="stylesheet" href="/css/panel-ui.css">
    <link rel="stylesheet" href="/css/anywhere3d.css">
    <link rel="stylesheet" href="/css/joystick.css">
    <link rel="stylesheet" href="/css/uppy.css">
</head>

<body>

<style>
    .navbar-nav > li > a.menu-item,
    .navbar-nav > li > div > a.menu-item {font-weight:normal;}
    .navbar-nav > li > a.menu-item:hover,
    .navbar-nav > li > div > a.menu-item:hover {color:aquamarine;}
    .navbar-nav > li > div > a.menu-item { text-decoration:none }
    #nav-btn-login { margin-left:10px; }
    #nav-btn-login > a { color:#fff; font-weight:bold; font-size:14px; text-decoration:none; }
    #nav-btn-snapshot > a { color:#38c0ee; }
</style>

<nav class="navbar navbar-default navbar-fixed-top">

    <div class="container">

        <div class="navbar-header">
            <div class="navbar-brand">
                <a href="https://anywhere3d.org" class="navbar-caption" title="anywhere3d.org">anywhere3d</a>
            </div>
            <a class="navbar-logo pull-left"><img src="https://i.imgur.com/09bC4Q0.png" alt="anywhere3d logo"></a>
            <ul class="nav navbar-nav navbar-right pull-left">
                
                <li class="first menu-item"></li>

                <li id="nav-item-over" style="display:none;"><a class="menu-item">Overview</a></li>
                <li id="nav-item-home" style="display:none;"><a class="menu-item">Home</a></li>
                <li id="nav-item-dash" style="display:none;"><a class="menu-item">Dashboard</a></li>
                <li id="nav-item-exam" style="display:none;"><a class="menu-item">Examples</a></li>

            </ul>
        </div>

        <ul class="nav navbar-nav navbar-right">

            <li class="pull-right">
                <div class="navbar-btn btn btn-primary btn-white-outline" id="nav-btn-login" style="display:none;">
                    <a class="menu-item">Login</a>
                </div>
            </li>

        </ul>

    </div>

</nav>

<style>
    body { margin:0px; height:100vh; overflow:hidden; font-family: Arial, sans-serif; }
    canvas { display:block !important; }
    #body-section { 
        height:100%; padding-top:0px; padding-bottom:0px; 
        background-color:rgba(0,0,0,1); overflow:hidden; 
    }
    #render-container { 
        width:100%; height:100%; 
        opacity:1; background-color:rgb(0,0,0); 
    }
    #splash-holder,
    #auth-holder { 
        position:absolute; left:0px; top:0px; width:100%; height:100%;
        text-align:center; background-color:rgba(255,255,255,0); z-index:1; 
    }
    .twitter-holder { text-align:center; margin:10px 0px; }    
    .patreon-holder { display:none; text-align:center; }
    #joystick1, #joystick2, #jumpButton  { z-index:0 !important; }
    .menu-helpers a,
    .editor-helpers a,
    .mode-helpers a,
    .updater-helpers a,
    .helpers a { font:bold 16px Arial; cursor:pointer; text-decoration:none; }
    .mode-helper a { color:fuchsia; }
    .ui-dialog { opacity:1 !important; }
    .non-ready { display:none; }
    .updater   { cursor:pointer; }
    
    .side-holder { width:84%; margin-bottom:10px; }
    .text-field { margin-bottom:10px; }
    #background-insert-button { margin-bottom:20px; }
    #form-holder { margin-bottom:20px; }

</style>

<section class="mbr-section mbr-after-navbar" id="body-section">

    <div id="render-container" class="mbr-overlay"></div>

    <div class="side-panel" id="right-side">
        <div id="right-side-pinbtn" title="click this to pin/unpin panel"></div>

        <div id="right-side-content">

            <div id="form-holder" class="side-holder">
                <!-- div id="skybox-form-holder" -->
                <form id="skybox-upload-form" name="skybox-upload-form">
                    <h4>Skybox Upload form</h4>
                    <div class="field-label">Skybox name:</div>
                    <input type="text" class="form-control text-field" id="form-name" name="name" placeholder="(required)" required>
                    <div class="field-label">Skybox title:</div>
                    <input type="text" class="form-control text-field" id="form-title" name="title">

                    <input type="hidden" class="img-data" id="data-pos-x" name="data-pos-x">
                    <input type="hidden" class="img-data" id="data-neg-x" name="data-neg-x">
                    <input type="hidden" class="img-data" id="data-pos-y" name="data-pos-y">
                    <input type="hidden" class="img-data" id="data-neg-y" name="data-neg-y">
                    <input type="hidden" class="img-data" id="data-pos-z" name="data-pos-z">
                    <input type="hidden" class="img-data" id="data-neg-z" name="data-neg-z">

                    <div class="field-label">Skybox insert:</div>
                    <div id="background-insert-button" class="form-control btn btn-primary btn-white-outline">Open skybox insert panel</div>

                    <input type="button" class="btn btn-danger btn-white-outline" id="form-reset" value="Reset">
                    <input type="button" class="btn btn-success btn-white-outline pull-right" id="upload-button" value="Upload" disabled>
                    <input type="submit" class="hidden" id="form-submit">
                </form>
                <!-- /div -->
            </div>

            <div id="background-button-holder" class="side-holder hidden">
                <div id="background-select-button" class="form-control btn btn-default btn-white-outline">Open skybox select panel</div>
            </div>

            <div id="editor-holder"></div>

        </div>
    </div>

</section>

<script src="/js/w3.js"></script>

            <!-- JQUERY -->

<script src="/js/jquery.min.js"></script>
<script src="/js/jquery.lazy.js"></script>
<script src="/js/jquery.lazy.plugins.js"></script>
<script src="/js/jquery-ui.js"></script>
<script src="/js/validator.min.js"></script>

<script>

    debugMode = true;

    var jsFolder = "/js/";
    var scriptsFolder = "/scripts/";
    var componentsFolder = "/components/";

    $.ajaxSetup({ cache: false });

</script>

         <!-- LOCAL FORAGE -->

<script src="/js/localforage.js"></script>

<script>
/*
//  Drop old stores.

    localforage.dropInstance({
        name: "anywhere3d",
        storeName: "AW3D_Data",
    }).then(function(){
        console.log("AW3D_Data dropped.");
    });

    localforage.dropInstance({
        name: "anywhere3d",
        storeName: "AW3D_db",
    }).then(function(){
        console.log("AW3D_db dropped.");
    });

    localforage.dropInstance({
        name: "anywhere3d",
        storeName: "AW3D_Texture",
    }).then(function(){
        console.log("AW3D_Texture dropped.");
    });

    localforage.dropInstance({
        name: "anywhere3d",
        storeName: "AW3D_DNA",
    }).then(function(){
        console.log("AW3D_DNA dropped.");
    });

    localforage.dropInstance({
        name: "anywhere3d",
        storeName: "AW3D_Cache",
    }).then(function(){
        console.log("AW3D_Cache dropped.");
    });

    localforage.dropInstance({name:"localforage"}).then(function(){
        console.log("localforage cleanup database dropped.");
    });
*/
</script>

<script>

    var CacheStorage = localforage.createInstance({
        driver: localforage.INDEXEDDB,
        name: "anywhere3d",
        storeName: "cache",
        version: 1.0
    });

    CacheStorage.ready().then(function() {
        console.log("[CacheStorage ready]:", CacheStorage.driver()); // <-- asyncStorage
    }).catch(function (err) {
        console.error("[CacheStorage Error]:", err); 
    });

</script>

<script src="/js/store2.js"></script>
<script src="/js/store.on.js"></script>
<script src="/js/store.array.js"></script>

<script async src="/js/rawinflate.js"></script>
<script async src="/js/rawdeflate.js"></script>

<script>

    function encode( string ) {
        return window.btoa( RawDeflate.deflate( string ) );
    }

    function decode( string ) {
        return RawDeflate.inflate( window.atob( string ) );
    }

//  Samples:

    function getDecodedItemFromLocalStorage( key ){
        return JSON.parse( RawDeflate.inflate( window.atob( localStorage.getItem( key ) ) ) );
    }

    function setEncodedItemToLocalStorage(key, data){
        localStorage.setItem(key, window.btoa( RawDeflate.deflate( JSON.stringify( data ) ) ) );
    }

</script>

<script async src="/js/alerts.js"></script>
<script async src="/js/bootbox.min.js"></script>
<script async src="/js/bootstrap.min.js"></script>
<script async src="/js/DeviceDetector.js"></script>
<script async src="/js/MathDecimalAdjustment.js"></script>
<script async src="/js/html2canvas.js"></script>
<script async src="/js/spectrum.js"></script>
<script async src="/js/watermark.js"></script>
<script async src="/js/sharer.js"></script>
<script async src="/js/side-panels.js"></script>

<script src="/three/three.js"></script>
<script src="/three/EditorControls.js"></script>
<script src="/three/Detector.js"></script>
<script src="/three/Projector.js"></script>
<script src="/three/Animation.js"></script>
<script src="/three/AnimationHandler.js"></script>
<script src="/three/KeyFrameAnimation.js"></script>
<script src="/js/scene-helpers.js"></script>

<script>

    THREE.Cache.enabled = true;
    THREE.Texture.DEFAULT_IMAGE = "https://i.imgur.com/8eycYxu.png";

</script>

       <!-- SCENE -->

<script src="/js/scene-helpers.js"></script>

<script>

//  scene.js

    var fontFolder = "/three/fonts/";
    var fontPath = fontFolder + "helvetiker_regular.typeface.json";
    var sceneContainerSelector = "#render-container";
    var container = $(sceneContainerSelector)[0];

    var scene, 
        camera, 
        renderer, 
        controls;

    var sceneLights, 
        axisCustomHelper, 
        axisOriginHelper;

    var projector, 
        keyboard, 
        clock;

    var scenename = "editor";

    scene = new THREE.Scene();
    scene.name = scenename;

    camera = new FpsCamera(50, 1, 10000);
    camera.position.set(0, 20, 100);

    controls = new THREE.EditorControls(camera);
    camera.lookAt(controls.center);

    scene.add(directionalLight(0xffffff,  1000, 1000,  1000, 0.5));
    scene.add(directionalLight(0xffffff,  1000, 1000, -1000, 0.5)); 
    scene.add(directionalLight(0xffffff, -1000, 1000,  1000, 0.5)); 
    scene.add(directionalLight(0xffffff, -1000, 1000, -1000, 0.5));
    scene.add(directionalLight(0xffffff,     0,-5000,     0, 0.3));

//    groundHelper = new GroundHelper(1000, 10);  
//    axisCustomHelper = new CustomAxisHelper(1200);
//    axisOriginHelper = new OriginAxisHelper(1000);

    projector = new THREE.Projector();
    clock = new THREE.Clock();

    renderer = new THREE.WebGLRenderer({
        antialias: true,
        preserveDrawingBuffer: true,
    });

    renderer.shadowMap.enabled = true;
    renderer.setPixelRatio( window.devicePixelRatio );
    renderer.setSize( container.clientWidth, container.clientHeight );
    container.appendChild( renderer.domElement );

    sceneBackground([
        "https://i.imgur.com/v6bjQLb.jpg", // "posx.jpg",
        "https://i.imgur.com/lwrlr6P.jpg", // "negx.jpg", 
        "https://i.imgur.com/kKUKBJg.jpg", // "posy.jpg", 
        "https://i.imgur.com/N0oZlJR.jpg", // "negy.jpg", 
        "https://i.imgur.com/x9q8z0K.jpg", // "posz.jpg", 
        "https://i.imgur.com/HYcK7Ii.jpg", // "negz.jpg"
    ]);

    function sceneBackground( urls ){
        if (!scene || Number(THREE.REVISION) < 78) return;
        var loader = new THREE.CubeTextureLoader();
        loader.load( urls, function(texture){
            scene.background = texture;
            scene.background.needsUpdate = true;
        });
    }

</script>

<script>

//  app.js

    var debugMode;
    var mouse = new THREE.Vector2();

    var rendererHalfWidth = renderer.domElement.width * 0.5;
    var rendererHalfHeight = renderer.domElement.height * 0.5;

//  Animate.

    animate();

    function animate(){

        windowAnimationFrameRequestID = requestAnimationFrame( animate );

        render();

        update();

    }

    function render(){ 
        renderer.render( scene, camera ); 
    };

    function update() {

        var delta = clock.getDelta();
        var time = clock.getElapsedTime();

        var $update = $(".update");
        if ( $update.length > 0 ) {
            for ( var i = 0; i < $update.length; i++ ){
                if ( !!$update[i].update ) $update[i].update(delta);
            }
        }
    }

//  Event Listeners.

    $(window).on( "resize", onWindowResize );

    function onWindowResize() {
        camera.aspect = container.clientWidth / container.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize( container.clientWidth, container.clientHeight );
        rendererHalfWidth = renderer.domElement.width * 0.5;
        rendererHalfHeight = renderer.domElement.height * 0.5;
    }

    $(window).on( "mousemove", onMouseMove );

    function onMouseMove( event ) {
        mouse.x = ( event.clientX - rendererHalfWidth );
        mouse.y = ( event.clientY - rendererHalfHeight );
    }

</script>

             <!-- COMPONENTS -->

<script>

//  form-panel.js

//  Every dialoge form panel point to a formTarget
//  that is a form and deals with this target only.

    var target; // IMPORTANT //

    var formPanelHtml = '<div id="form-panel" title="Form Panel">';

    var $FormPanel = $(formPanelHtml).dialog({ 
        autoOpen: false, 
        show: { effect: 'fade', duration: 500 },
        hide: { effect: 'fade', duration: 500 },
    });

    $FormPanel.on( "dialogopen", function( event, ui ) {

        $FormPanel.active = true;
        debugMode && console.log( "target:", !!target );
        debugMode && console.log( "dialog opened:", $FormPanel.active );
        
    });

    $FormPanel.on( "dialogclose", function( event, ui ) {

        target = undefined;
        $FormPanel.active = false;
        $FormPanel.contents().remove();

        debugMode && console.log( "target:", target );
        debugMode && console.log( "dialog closed:", !$FormPanel.active );

    });

    $FormPanel.loadForm = function(component, option){
        var formComponent = componentsFolder + component; 
        $FormPanel.load(formComponent, function(resoponse, status, xhr){
            debugMode && console.log("form loaded:", status);
            if (!!option) $FormPanel.dialog( "option", option );
        });
    }

</script>

<script>
/*
//  background-insert-button.html.
    var backgroundInsertHolderSelector = "#background-insert-holder";
    var backgroundInsertButtonComponent = componentFolder + "background-insert-button.html";
    $(backgroundInsertHolderSelector).load(backgroundInsertButtonComponent, function(resoponse, status, xhr){
        debugMode && console.log("background-insert-button:", status);
    });
*/
</script>

<script>

//  Controls.
    $FormPanel.on( "dialogopen", function( event, ui ) {
        if (!!window.controls) controls.enabled = false;
    });

    $FormPanel.on( "dialogclose", function( event, ui ) {
        if (!!window.controls) controls.enabled = true;
    });

</script>

<script>

//  background-insert-button.html.

    var backgroundInsertButtonSelector = "#background-insert-button";

//  Define target.
    $(backgroundInsertButtonSelector).on("click", function (){
        if ( !$FormPanel.active ){
            target = scene.background; // cube texture.
        } else {
            target = undefined;
        }
    });

//  Import dialog components.
    $(backgroundInsertButtonSelector).on("click", function (){
        if ( !$FormPanel.active ){

            $FormPanel.dialog( "option", {
                width    : 600,
                minWidth : 600,
                maxWidth : 600,
                height   : 600,
                minHeight: 600,
                maxHeight: 600,
                title: "Skybox Insert Form"
            });

        }

    });

//  Load form.
//  $FormPanel.loadForm("scene-background-insert-form.html");
    $(backgroundInsertButtonSelector).on("click", function(){
        if ( !$FormPanel.active ){
            var skyboxInsertFormComponent = componentsFolder + "skybox-insert-form.html";
            $FormPanel.load(skyboxInsertFormComponent, function(resoponse, status, xhr){
                debugMode && console.log("skybox-insert-form:", status);
            });
        }
    });

//  Open/Close dialog (always last).
    $(backgroundInsertButtonSelector).on("click", function (){
        if ( !$FormPanel.active ){
            $FormPanel.dialog("open");
        } else {
            $FormPanel.dialog("close");
        }
    });


</script>

<script>

//  background-select-button.html.

    var backgroundSelectButtonSelector = "#background-select-button";

//  Define target.
    $(backgroundSelectButtonSelector).on("click", function (){
        if ( !$FormPanel.active && !!scene.background ){
            target = scene.background; // cube texture.
        } else {
            target = undefined;
        }
    });

//  Import dialog components.
    $(backgroundSelectButtonSelector).on("click", function (){
        if ( !$FormPanel.active ){

            $FormPanel.dialog( "option", {
                width    : 600,
                minWidth : 600,
                maxWidth : 600,
                height   : 600,
                minHeight: 600,
                maxHeight: 600,
                title: "Skybox Select Panel"
            });

        }

    });

//  Open/Close dialog.
    $(backgroundSelectButtonSelector).on("click", function (){
        if ( !$FormPanel.active ){
            $FormPanel.dialog("open");
        } else {
            $FormPanel.dialog("close");
        }
    });

//  Load component.
//  $FormPanel.loadForm("skybox-select-buttons.html");
    $(backgroundSelectButtonSelector).on("click", function(){
        if ( $FormPanel.active ){
            var skyboxSelectButtonsComponent = componentsFolder + "skybox-select-buttons.html";
            $FormPanel.load(skyboxSelectButtonsComponent, function(resoponse, status, xhr){
                debugMode && console.log("skybox-select-buttons:", status);
            });
        }
    });

</script>

<script>

//  skybox-upload-form.html

    var imgDataSelector  = ".img-data";
    var posxDataSelector = "#data-pos-x";
    var posyDataSelector = "#data-pos-y";
    var poszDataSelector = "#data-pos-z";
    var negxDataSelector = "#data-neg-x";
    var negyDataSelector = "#data-neg-y";
    var negzDataSelector = "#data-neg-z";

    var skyboxUploadFormSelector = "#skybox-upload-form";
    var skyboxUploadForm = $(skyboxUploadFormSelector)[0];

    var formNameSelector     = "#form-name";
    var formTitleSelector    = "#form-title";
    var formResetSelector    = "#form-reset";
    var formSubmitSelector   = "#form-submit";
    var uploadButtonSelector = "#upload-button";    

    $(formResetSelector).on("click", function(){
        debugMode && console.log( formResetSelector, "reset" );
        $(uploadButtonSelector)[0].disabled = true;
        $(imgDataSelector).val("");
        skyboxUploadForm.reset();
    });

    $(uploadButtonSelector).one("click", function(){
        debugMode && console.log( uploadButtonSelector, "click");
        $(skyboxUploadFormSelector).submit();
    });

</script>

<script>

//  skybox-upload-form-submit.js

    $(skyboxUploadFormSelector).on("submit", function (e){

        e.preventDefault();
        $(uploadButtonSelector)[0].disabled = true;
        debugMode && console.log( skyboxUploadFormSelector, "submit");

    //  Validate form.
        if ( !this.checkValidity() ) {
            this.reportValidity();
        }

        var entry = {};
        entry.type  = "skybox";
        entry.name  = $(formNameSelector).val();
        entry.title = $(formTitleSelector).val();
        entry.IDs  = {};
        entry.URLs = {};
        entry.ids  = [];
        entry.urls = [];

        Promise.all([

            new Promise( function(resolve, reject){
                var file = dataURLtoBlob( $(posxDataSelector).val() );
                uploadToImgur( file, function(res){
                    debugMode && console.log( "posx res:", res.data);
                    resolve( res.data );
                });
            }),

            new Promise( function(resolve, reject){
                var file = dataURLtoBlob( $(negxDataSelector).val() );
                uploadToImgur( file, function(res){
                    debugMode && console.log( "negx res:", res.data);
                    resolve( res.data );
                });
            }),
    
            new Promise( function(resolve, reject){
                var file = dataURLtoBlob( $(posyDataSelector).val() );
                uploadToImgur( file, function(res){
                    debugMode && console.log( "posy res:", res.data);
                    resolve( res.data );
                });
            }),
    
            new Promise( function(resolve, reject){
                var file = dataURLtoBlob( $(negyDataSelector).val() );
                uploadToImgur( file, function(res){
                    debugMode && console.log( "negy res:", res.data);
                    resolve( res.data );
                });
            }),
    
            new Promise( function(resolve, reject){
                var file = dataURLtoBlob( $(poszDataSelector).val() );
                uploadToImgur( file, function(res){
                    debugMode && console.log( "posz res:", res.data);
                    resolve( res.data );
                });
            }),
    
            new Promise( function(resolve, reject){
                var file = dataURLtoBlob( $(negzDataSelector).val() );
                uploadToImgur( file, function(res){
                    debugMode && console.log( "negz res:", res.data);
                    resolve( res.data );
                });
            })

        ]).then( function(results){
            console.log("results:", results);

            for (var i=0; i < results.length; i++){
                var data = results[i];
                var key = ["", "textures", "skybox", entry.name, i, data.id].join("/");
                AW3D_db.setItem(key, data).then(function(result){
                    debugMode && console.log( "result:", result );
                });
            }

        }).then( function(){

            // insert entry //

        }).then( function(){

            // reset form //

        }).catch(function(err){
            console.error(err);
        });


/*
        var file = dataURLtoBlob( $(posxDataSelector).val() );
        debugMode && console.log( "posx file:", posxfile);
        uploadToImgur( posxfile, function(res){
            debugMode && console.log( "%s response: %o", posxDataSelector, res.data);
        
            var data = res.data;
            var id = data.id;
            var url = data.link;

            entry.ids[0]    = data.id;
            entry.urls[0]   = data.link
            entry.IDs["posx"]  = data.id;
            entry.URLs["posx"] = data.link;

            entry.thumb = "https://i.imgur.com/" + data.id + "m" + ".jpg"; // TODO: to get extention from data.

            var key = "/textures/skybox/" + data.id;
            AW3D_db.setItem(key, data).then(function(result){
                debugMode && console.log( "result:", result );
            });

        });
*/

/*
        Promise.all([

        ]).then( function(results){
            console.log(results);
        });
*/





    
        function dataURLtoBlob(dataurl) {
            var arr = dataurl.split(','), 
                mime = arr[0].match(/:(.*?);/)[1],
                bstr = atob(arr[1]), 
                n = bstr.length, 
                u8arr = new Uint8Array(n);
                
            while(n--){
                u8arr[n] = bstr.charCodeAt(n);
            }
    
            return new Blob([u8arr], {type:mime});
        }
    
        function uploadToImgur(file, callback) {
    
            var clientid = "95e1ecaf14ca5e6";
            var endpoint = "https://api.imgur.com/3/image";
    
            var formdata = new FormData();
            formdata.append("image", file);
    
            var xhttp = new XMLHttpRequest();
    
            xhttp.open('POST', endpoint, true);
            xhttp.setRequestHeader('Authorization', 'Client-ID ' + clientid);
            xhttp.onreadystatechange = function () {
                if (this.readyState === 4) {
    
                    var response = "";
    
                    if (this.status >= 200 && this.status < 300) {
    
                        try {
                            response = JSON.parse(this.responseText);
                        } catch (err) {
                            response = this.responseText;
                        }
    
                        callback.call(window, response);
    
                    } else {
    
                        try {
                            response = JSON.parse(this.responseText);
                            debugMode && console.log( "Error response:", response );
                            var error = response.data.error;
                            var code = error.code || response.status;
                            var message = error.message || error;
                            debugMode && console.error( "Error status:", this.status, "- error.code:", error.code, "- error:", error );
                            bootboxErrorAlert( "<b>Error code: " + code + "</b><br>" + message );
                        } catch (err) {
                            var error = this.responseText;
                            debugMode && console.error( "Error:" + this.status, error );
                        }
    
                    //  $("#spin").remove();
    
                    }
    
                }
            };
    
            xhttp.send(formdata);
            xhttp = null;
        }

    });

</script>




<script>
/*
//  editor-panel.js

    var $EditorPanel;

    var editorPanelScript = "/js/editor-panel.js";
    $.getScript( editorPanelScript, function(script, status, xhr){
        debugMode && console.log("editor-panel:", status);

        $EditorPanel.on( "dialogopen", function( event, ui ) {
            if (!!window.controls) controls.enabled = false;
        });

        $EditorPanel.on( "dialogclose", function( event, ui ) {
            if (!!window.controls) controls.enabled = true;
        });

    });
*/
</script>

<script>
/*
//  scene-editor-panel.js

    var debugMode;

    var target;       // IMPORTANT //
    var textureSize;  // IMPORTANT //

//  Every dialoge panel point to a target object that can be 
//  mesh, geometry, face, vertex, object3d, material, texture
//  scene or whatever and deals with this target only.

    var sceneEditorPanelHtml = '<div id="scene-editor-panel" title="Scene Editor">';
    var $SceneEditorPanel = $(sceneEditorPanelHtml).dialog({ 
        autoOpen: false, 
        show: { effect: 'fade', duration: 500 },
        hide: { effect: 'fade', duration: 500 },
    });

    $SceneEditorPanel.on( "dialogopen", function( event, ui ) {
        $SceneEditorPanel.active = true;
        debugMode && console.log( "dialog opened:", $SceneEditorPanel.active );
    });

    $SceneEditorPanel.on( "dialogclose", function( event, ui ) {
        $SceneEditorPanel.active = false;
        debugMode && console.log( "dialog closed:", !$SceneEditorPanel.active );
        $SceneEditorPanel.contents().remove();
    });

//    width:    616,
//    minWidth: 616,
//    maxWidth: 616,
//    height:   600,
//    minHeight:600,
//    maxHeight:600
*/
</script>

<script>
/*
//  scene-background-button.html
    var backgroundButtonHolderSelector = "#background-button-holder";
    var sceneBackgroundButtonComponent = componentsFolder + "scene-background-button.html";
    $(backgroundButtonHolderSelector).load(sceneBackgroundButtonComponent, function(resoponse, status, xhr){
        debugMode && console.log("scene-background-button:", status);
    });
*/
</script>

</body>
</html>
